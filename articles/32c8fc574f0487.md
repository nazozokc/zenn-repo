---
title: "nixに移行した話"
emoji: "🗂"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["nix", "cli", "dotfiles"]
published: true 
---

# なぜnixを使おうと思ったか
なぜnixを使おうと思ったかというと、単純になんかみんな最近nix,nix言っているからです。みんな言ってたらそりゃ試したくなりますよ。
まだ学びたての意見ですが参考になれば幸いです。

# 構成
基本的にdotfilesとパッケージ管理をnixに移行しました
ファイル構成は以下のようになりました

```
dotfiles/
|-nvim/
|-wezterm/
|-fish/
|-zsh/
|-nix/
|  |-config-sym.nix
|  |-pkgs/
|     |-cli-tool.nix
|     |-gui-tool.nix
|     |-nvim.nix
|
flake.nix
flake.lock
```
という構成になりました。
意識したことは、楽に管理できることです。

# ファイルの中身
ファイルの中身は、今回は３つ紹介しようと思います。
## １つ目は`flake.nix`です。
```
{
  description = "nazozokc dotfiles";

  inputs = {
    nixpkgs.url = "github:NixOS/nixpkgs/nixos-unstable";
    home-manager = {
      url = "github:nix-community/home-manager";
      inputs.nixpkgs.follows = "nixpkgs";
    };
  };

  outputs = { nixpkgs, home-manager, ... }:
  let
    system = "x86_64-linux";

    pkgs = import nixpkgs {
      inherit system;
      config = {
        allowUnfree = true;
        };
    };
  in {
    homeConfigurations.nazozokc =
      home-manager.lib.homeManagerConfiguration {
        inherit pkgs;

        modules = [
          ({ config, pkgs, ... }: {
            home.username = "nazozokc";
            home.homeDirectory = "/home/nazozokc";
            home.stateVersion = "24.05";

            programs.home-manager.enable = true;

            imports = [
              ./nix/config-sym.nix
              ./nix/pkgs/cli-tool.nix
              ./nix/pkgs/nvim.nix
              ./nix/pkgs/gui-tool.nix  # ← ここも typo 修正
            ];
          })
        ];
      };
  };
}

```

flake.nixでは基本的に読み込むファイルやどのurlからパッケージを取ってくるかを指定していますね。
パッケージ名は別のファイルで管理していてこれはそのディレクトリを読み込んでいますね。

## ２つ目は`config-sym.nix`
```
{ config, pkgs, ... }:

{
  home.file = {
    ".config/fish" = {
      source = ../fish;
      recursive = true;
      force = true;
    };

    ".config/nvim" = {
      source = ../nvim;
      recursive = true;
      force = true;
    };

    ".config/wezterm" = {
      source = ../wezterm;
      recursive = true;
      force = true;
    };

    ".zshrc" = {
      source = ../zsh/zshrc;
      force = true;
    };
  };
}

```
このファイルは.configにsymリンクを作成するためのディレクトリですね
いちいちコマンド打つのが面倒だったのでこれで全て生成されるようになっています。

## ３つ目は`cli-tool.nix`です
```
{ pkgs, ... }:

{
  home.packages = with pkgs; [
    # 基本
    git
    gh
    curl
    wget

    # 便利CLI
    ripgrep   # rg
    fd        # fd
    bat       # cat代替
    eza       # ls代替
    fzf       # fuzzy finder
    neovim
    fish
    lazygit

    # アーカイブ/検索
    unzip
    zip
    jq
    tree

    # ネットワーク/デバッグ
    httpie
    tcpdump
  ];
}

```
このファイルは普段自分が使うcliツールをインストールできるようにしていますね
fzfとかneovimはマジ便利で沼ったら抜け出せない、nixも同じですね。

---

# まとめ
いかがでしたでしょうか？今回は私が初心者ながら実際にどのようにnixを使っているかを紹介しました、コードはほぼAIなんですけどねw。
今回の記事が少しでも皆さんの役に立てば幸いです
記事はファイルの中身や使い方が変わったら更新しようと思います。

https://github.com/nazozokc/dotfiles

---
今回の記事はこのレポジトリで公開しています。間違っている場所があればissueを立てていただければ幸いです。
https://github.com/nazozokc/zenn-repo
